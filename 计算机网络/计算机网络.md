# 计算机网络

## 概述

### 网络发展三个阶段：

> ARPANET
>
> 三级结构
>
> > 分为主干网，地区网，校园网（或企业网）
>
> 全球范围 多层次 ISP结构：因特网服务提供者

### 传统的三网：

> 电信网
>
> 有线电视网
>
> 计算机网络

### 组成

> 边缘部分（主机）
>
> 核心部分（网络与路由器）

### 通信方式

> C-S方式：区分客户与服务器
>
> 对等（P2P）方式：不区分服务请求方与服务提供方

### 路由器的作用

> 分组交换：转发对应的分组

### 三种交换方式

> 电路交换
>
> 报文交换
>
> 分组交换

### 网络的分类

> 基于作用范围
> > WAN广域网
> >
> > MAN城域网
> >
> > LAN局域网
> > 
> > PAN个人局域网
> 
> 基于使用者
> > 公用网
> > 专用网
> > 虚拟专用网络（VPN）



### 网络性能指标（计算题1-17,1-18）

> 速率
>
> 带宽（信道所能传输的最高数据率）
>
> > 信号的宽度随带宽的增大而变窄
>
> 吞吐量（单位时间通过的实际数据量）
>
> 时延（计算）
>
> > 发送时延（计算）
> >
> > 传播时延（计算）
> >
> > 处理时延
> >
> > 排队时延
>
> 总时延 = 发送时延+传播时延+处理时延+排队时延

### 协议的要素

>语法，语义，同步

## 物理层

> 目的：在媒体上传输比特流

### 信噪比

> 信号与噪声的平均功率之比
>
> 公式：db=10 log_10/（S/N）
>
> 极限速率传输速率：C=Wlog_2(1+S/N)

### ISM

> 无线局域网可自由使用的频段

### 物理层传输媒体

> 导引型
>
> > 同轴电缆
> >
> > 双绞线
> >
> > > 区分有无屏蔽层，绞合度
> >
> > 光纤：体积小，重量轻，抗干扰性好
> >
> > > 单模，远，慢
> > >
> > > 多模，近，快
>
> 非导引型
>
> > 自由空间

### 模拟数字信号相比

> 模拟信号为连续的
>
> 数字信号为离散的

### 信道通信方式

> 单向（单工）
>
> 双向交替（半双工）
>
> 双向同时（全双工）

### 调制方式

> 基带调制：仅变换波形，称为编码
>
> 带通调制：使用载波进行调制，将频率范围移到较高频段，并**转为模拟信号**

### 调制方法

> 调幅，调频，调相

### 编码方式特点

> 曼彻斯特，差分曼彻斯特：频率高，能自同步

### 信道复用（计算题）

> FDMA 频分复用多址（光纤中WDMA波分复用）
>
> TDMA时分复用多址
>
> CDMA码分多址（计算题）

### ADSL

> 非对称数字用户线
>
> 低频留给传统电话，高频用于上网，上下行不对称

## 数据链路层

> 链路是无源的点到点的物理线路段，中间没有交换阶段
>
> 数据链路：物理链路加协议

### 使用协议

> PPP点对点
>
> CSMA/CD载波监听，多点接入，碰撞检测

### 数据链路信道

> 点对点
>
> 广播

### 数据链路协议的三个基本问题（CRC计算3-07）

> 封装成帧（加头尾）
>
> 透明传输（解决控制字符,用字节填充/字符填充）
>
> 差错控制（CRC）（计算）

### PPP(点对点协议)

> 三个组成部分：
>
> > IP数据报封装到串行链路
> >
> > LCP链路控制协议
> >
> > NCP网络控制协议
>
> 流程
>
> 链路协商->用户名密码鉴别->网络层协议配置

### 局域网拓扑结构

> 星型，总线

### 适配器(网卡)作用（简答）

> 串并行转换
>
> 缓存数据
>
> 安装驱动
>
> 实现以太网协议

### CSMA/CD

> 载波监听、多点接入/碰撞检测

### 争用期

> 数据端到端往返时间称之为t(tao,一声)
>
> 2t称之为争用期/碰撞窗口
>
> 因此需要最短有效帧长

### 最短有效帧长（简答）

> 发送帧的时间必须要大于争用期，并在这段时间内没有检测到碰撞才视为有效，因此为使得发送时间大于争用期，规定最短有效帧长为64字节

### MAC

> MAC:媒体介入控制，共**48位**
>
> 硬件地址/物理地址/MAC地址
>
> 注册管理机构RA向厂家分配高24位
>
> 低24位称为扩展标识符

### 接收逻辑判断，检查MAC地址

> 符合则收下，不符合则丢弃
>
> 分为三种帧
>
> > 单播
> >
> > 多播
> >
> > 广播

### MAC帧的格式

> 先目的地址后源地址
>
> 额外附加18字节
>
> 前面有7字节的同步码与1字节定界符，不算在帧内

### MTU

> 最大传送单元
>
> 规定**数据字段**的最大长度

### 如何算作无效MAC帧（简答）

> 数据字段长度与长度字段的值不同
>
> 数据字段长度不在46-1500字节之间
>
> 帧的长度不在64-1518字节之间
>
> 帧的长度不是整数字节
>
> 帧检验序列FCS查出有错

若无效则直接丢弃

### MAC帧自学习算法（大题，3-33）

>更新：交换机收到一个帧后先自学习
>
>> 查找匹配度源地址：
>>
>> 若没有则增加，若有则更新
>
>转发
>
>> 查找匹配的目的地址
>>
>> 若没有则进行广播（除来源外）
>>
>> 若有则按表转发

### 碰撞域/集线器/交换机

> 任意时刻只能有一个站发送数据，否则会产生碰撞
>
> 集线器组成的局域网在一个碰撞域中，交换机每个端口为一个独立的冲突域
>
> 集线器每个用户、端口占有的平均带宽为1/n，总带宽为1
>
> 交换机每个用户/端口占有的平均带宽为1，总带宽为n
>
> 交换机转发端口基于mac地址，集线器转发给所有端口

### 物理媒介标识符

10BASE-T

> 10:速率，单位为兆位/秒（非字节）
>
> BASE：基带
>
> T：双绞线
>
> > TX 屏蔽双绞线
> >
> > T4 4类双绞线
> >
> > C 铜缆
> >
> > F L S 光纤  

## 网络层

> 无连接 
>
> 尽最大努力传输（不可靠）
>
> 数据报服务

### 使用协议

> ICMP：网络控制报文协议
>
> IGMP：网络组管理协议
>
> ARP：地址解析协议

### IP地址分类

> 网络号，主机号
>
> ABCD类：
>
> > A:0-127,8位网络号，0开头
> >
> > B:128-191,16位网络号，10开头
> >
> > C:192-223,24位网络号，110开头
> >
> > D:224-239,多播地址，1110开头
> >
> > E:240之后，1111开头
>
> 一般不使用的：
>
> > | **网络号**   | **主机号**                                 | **源地址** | 目的地址 | **代表的意思**                                               |
> > | ------------ | ------------------------------------------ | ---------- | -------- | ------------------------------------------------------------ |
> > | **0**        | **0**                                      | **可以**   | **不可** | **在本网络上的本主机（见** **6.6** **节** **DHCP** **协议）** |
> > | **0**        | **host-id**                                | **可以**   | **不可** | **在本网络上的某台主机** **host-id**                         |
> > | **全** **1** | **全** **1**                               | **不可**   | **可以** | **只在本网络上进行广播（各路由器均不转发）**                 |
> > | **net-id**   | **全** **1**                               | **不可**   | **可以** | **对** **net-id** **上的所有主机进行广播**                   |
> > | **127**      | **非全** **0** **或全** **1** **的任何数** | **可以**   | **可以** | **用作本地软件环回测试之用**，仅在网络层交互，不经过链路和物理层 |
>
> 总结：0指自己，1指广播，全0全1均不能作为主机地址

### 路由器转发

> 在路由器转发之间，IP数据报中的IP源地址与目的地址始终不变，MAC地址会随着转发而改变

### IP首部格式

> 前有20字节固定长度，后有可选字段
>
> 可选字段用全0的填充字段填充成4字节的整数倍

### ARP（简答）

> 地址解析协议
>
> 解决IP地址与MAC地址的映射问题
>
> 由于没有相关的安全验证，可能会出现ARP欺骗
>
> 具体方法
>
> > 1.A广播请求分组，包含A本机IP,本机MAC,目的IP
> >
> > 2.目的IP相同的主机B接收请求分组，向指定的主机A单播自己的IP与MAC
> >
> > 3.A将B的映射写入缓存，B将A的映射写入缓存

### IP数据报分片（大题）（重点）

> ID：产生一个数据报则加1，相同数据报的分片ID相同
>
> 标志位：MF=1：后面还有分片  DF=0:允许分组
>
> 片偏移：以8字节为偏移单位，相对于原数据报数据段的起点

### 特定主机路由 /默认路由

> 特定主机路由：为特定的目的主机指定一个路由
>
> 默认路由：无论分组的指定网络在哪里，都由指定的路由处理

### 子网掩码计算网络地址

> 转换为二进制然后逐位相与

### 划分子网后转发分组算法（大题，但老师没提）

> 按照优先级
>
> 1：检查网络号与**直接相连的**各网络的网络号是否匹配
>
> 2：特定主机路由
>
> 3：检查网络号与路由表中网络号是否匹配
>
> 4：默认路由

### IP编址问题演进

> 二级地址分类->三级地址（划分子网）->CIDR
>
> CIDR采用斜线记法，在IP地址后加一个斜线，然后协商网络前缀所占的位数
>
> 网络前缀相同的连续IP地址称为“CIDR地址块”
>
> 最小地址为0，最大地址为全1，但一般不使用

### CIDR地址块划分（可能大题，但老师没提）

> 二叉树，地址块开始结束，子网掩码，广播地址
>
> 看课后题

### 最长前缀匹配（大题）

> 收到的地址与路由器中的项目地址的子网掩码进行与操作
>
> 与的结果选择匹配的那项
>
> 如果都匹配选择掩码更长的

### ICMP

> 网络控制报文协议
>
> 用于报告差错情况与提供有关异常情况的报告
>
> 分为差错报告报文与询问报文
>
> 差错报告：
>
> > · 终点不可达
> >
> > · 时间超过
> >
> > · 参数问题
> >
> > · 重定向
>
> 以下几种不发送
>
> > 对差错报文本身
> >
> > 对第一个分片的数据报片的所有后续数据报片
> >
> > 对多播地址
> >
> > 对特殊地址127或全0
>
> 应用：PING,不经过传输层，用于测试两个主机的连通性，使用ICMP请求与回复。

### 路由算法的自适应性

> 静态：人工配置
>
> 动态：路由算法自动生成

### 网关协议

> AS:自治系统，在单一技术管理下的一组路由器，使用一致的路由选择策略
>
> 自治系统之间称为**域间路由选择**自治系统内部称为**域内路由选择**
>
> 分为内部网关协议与外部网关协议
>
> 内部网关协议：RIP，OSPF
>
> 外部网关协议：BGP

### RIP（大题）

> 基于距离向量的路由选择协议
>
> 特点：
>
> >  仅与相邻路由器交换信息
> >
> > 交换的是**本路由器的路由表**（到所有网络的距离和下一跳路由器）（体现基于距离向量）
> >
> > 按照固定的时间间隔交换
> >
> > 有“好消息传播的快，坏消息传播的慢”的特点
> >
> > 只适用于小型网络
>
> **如何生成自己的路由表**（大题）

### OSPF

> 基于链路状态协议
>
> 特点：
>
> >向所有路由器发送信息（洪泛法）
> >
> >发送的是**相邻所有路由器的链路状态**，最终知道整个网络的拓扑结构
> >
> >当链路状态发生变化时进行发送
> >
> >没有“好坏消息”的特点
> >
> >能够用于很大规模的网络

### BGP

> 不同的自治系统的路由器之间交换信息
>
> 交换自治系统的可达性

### 交换结构

> 常用交换方法
>
> > 通过存储器
> >
> > 通过总线
> >
> > 通过纵横交换结构

### 指明的专用地址

> 10开头
>
> 172.16-172.32
>
> 192.168开头
>
> 只作为本地地址，内部通讯用

### VPN

> 虚拟专用网络

### IPV6

> 仍然支持无连接
>
> 地址扩展到128位
>
> 数据报由两部组成：基本首部（40字节）有效载荷（包含扩展首部与数据部分）
>
> 过渡时策略有：双协议栈，隧道技术
>
> IGMP与ARP被合并

### SDN

> 体系结构
>
> 把控制层面与数据层面分离
>
> 目前采用OpenFlow协议

## 运输层

> 主机间的通信事实上是主机中的应用进程互相通信，又称为端到端的通信
>
> 很重要的功能为复用和分用

### 协议

> UDP 用户数据报协议，TCP传输控制协议
>
> ARQ 自动重传请求

> UDP特点：
>
> > 无连接
> >
> > 尽最大努力交付
> >
> > 面向报文
> >
> > 无拥塞控制
> >
> > 支持一对多，多对多
> >
> > 首部8字节，开销小
>
> TCP特点：
>
> > 面向连接
> >
> > 可靠交付
> >
> > 面向字节流
> >
> > 有拥塞控制
> >
> > 只能1对1
> >
> > 全双工
> >
> > 首部20字节

### 套接字

> IP地址+端口号，确定TCP通信的端点

### 可靠性保证

>自动重传请求：重传自动进行，不需要重复提出请求
>
>累计确认：对最后一个分组进行确认，表示到这个分组为止都已经正确受到
>
>滑动窗口
>
>动态变化的RTT（往返时间）

### 流量控制/拥塞控制（简答）

> 利用滑动窗口实现
>
> 流量控制为点对点通信量的控制
>
> 流量控制目的为使得接收方有充足时间接收处理
>
> 拥塞控制是全局性的过程，涉及所有主机与路由器
>
> 拥塞控制目的为使得网络中的路由器或链路不过载

### 流量控制过程（大题）

> 结合145PPT
>
> 接收方通过控制接收窗口大小来实现流量控制

### 零窗口/持续计时器

> 目的：为打破死锁
>
> 零窗口：接收窗口为0
>
> 持续计时器：在收到零窗口通知后启用，到时间则发送探测报文段

### 慢开始（老师要求会做题）

> 当发送窗口小于慢开始门限时，发送窗口每次×2
>
> 当大于时，每次+1
>
> 当出现拥塞（没有按时受到确认），将慢开始门限设为当前发送窗口的1/2，然后重置发送窗口为1

### AQM

> 主动队列管理
>
> 当队列长度到达某个阈值时，主动随机丢弃到达的分组

### TCP连接

> 三个阶段
>
> > 连接建立
> >
> > 数据传送
> >
> > 连接释放
>
> 主动建立连接的一方为客户

#### 连接建立

三次握手

> 1:SYN=1，ACK=0,序号seq为x1,发往服务器
>
> 2:SYN=1，ACK=1,序号seq=y1,ack=x1+1发往客户端、
>
> 3:SYN=1，ACK=1,序号seq=x1+1,ack=y1+1发往服务器

四次挥手

>1:FIN=1 ACK=0,序号seq=x2,发往服务器
>
>2:ACK=1 序号seq=y2,ack=x2+1,发往客户端
>
>3:FIN=1,ACK=1,序号seq=y3,ack=x2+1,发往客户端
>
>4:ACK=1 序号seq=x2+1,ack=y3+1，发往服务端

## 应用层

DNS(域名系统)

WWW(HTTP)

### 应用层协议与传输层协议

| TCP                       | UDP            |
| ------------------------- | -------------- |
| FTP,TELNET,HTTP,SMTP,POP3 | TFTP,DHCP,SNMP |



### 域名结构

> 三级域名.二级域名.顶级域名

### DNS域名服务器

> 根域名服务器，最顶级，知道所有顶级域名服务器的域名和IP地址

### 文件传输协议

> 采用TCP协议

### 万维网

> 采用统一资源定位符**URL**标志万维网上的各种文档
>
> URL格式：<协议>://<主机>:<端口>/<路径>
>
> 采用超文本传输协议**HTTP**实现各种超链的链接，使用TCP
>
> > HTTP分为请求报文/响应报文，字段长度不确定
>
> > 请求报文分为三个部分：开始行，首部行，实体主体，其中开始行为请求行，包含请求方法，URL，HTTP版本
>
> > 响应报文同理，开始行为响应行，包含HTTP版本，状态码，解释状态码的短语

### 状态码

>1xx 表示通知信息的，如请求收到了或正在进行处理。
>
>2xx 表示成功，如接受或知道了。
>
>3xx 表示重定向，表示要完成请求还必须采取进一步的行动。
>
>4xx 表示客户的差错，如请求中有错误的语法或不能完成。
>
>5xx 表示服务器的差错，如服务器失效无法完成请求。

## 总结

### 五层协议体系架构（简答）

| 层次       | 设备                 | 协议                          |
| ---------- | -------------------- | ----------------------------- |
| 应用层     |                      | HTTP,FTP,POP3,SMTP            |
| 传输层     | 网关（用于协议转换） | TCP,UDP,ARQ                   |
| 网络层     | 路由器               | IP,ICMP.IGMP,ARP,TIP,OSFP,BGP |
| 数据链路层 | 网桥，交换机，网卡   | PPP,CSMA/CD                   |
| 物理层     | 转发器，集线器，网卡 |                               |

>